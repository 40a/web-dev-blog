Начало работы с Vagrant
=======================
* **[Начало](#%D0%9D%D0%B0%D1%87%D0%B0%D0%BB%D0%BE)**
  * [Где взять VirtualBox](#%D0%93%D0%B4%D0%B5-%D0%B2%D0%B7%D1%8F%D1%82%D1%8C-virtualbox)
  * [Установка Vagrant](#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0-vagrant)
  * [Ваше первое виртуальное окружение Vagrant](#%D0%92%D0%B0%D1%88%D0%B5-%D0%BF%D0%B5%D1%80%D0%B2%D0%BE%D0%B5-%D0%B2%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5-%D0%BE%D0%BA%D1%80%D1%83%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5-vagrant)
* **[Преимущества от использования Vagrant](#%D0%9F%D1%80%D0%B5%D0%B8%D0%BC%D1%83%D1%89%D0%B5%D1%81%D1%82%D0%B2%D0%B0-%D0%BE%D1%82-%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-vagrant)**
  * [Преимущества для одного разработчика](#%D0%9F%D1%80%D0%B5%D0%B8%D0%BC%D1%83%D1%89%D0%B5%D1%81%D1%82%D0%B2%D0%B0-%D0%B4%D0%BB%D1%8F-%D0%BE%D0%B4%D0%BD%D0%BE%D0%B3%D0%BE-%D1%80%D0%B0%D0%B7%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%87%D0%B8%D0%BA%D0%B0)
  * [Преимущества для команды разработчиков](#%D0%9F%D1%80%D0%B5%D0%B8%D0%BC%D1%83%D1%89%D0%B5%D1%81%D1%82%D0%B2%D0%B0-%D0%B4%D0%BB%D1%8F-%D0%BA%D0%BE%D0%BC%D0%B0%D0%BD%D0%B4%D1%8B-%D1%80%D0%B0%D0%B7%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%87%D0%B8%D0%BA%D0%BE%D0%B2)
  * [Преимущества для компании](#%D0%9F%D1%80%D0%B5%D0%B8%D0%BC%D1%83%D1%89%D0%B5%D1%81%D1%82%D0%B2%D0%B0-%D0%B4%D0%BB%D1%8F-%D0%BA%D0%BE%D0%BC%D0%BF%D0%B0%D0%BD%D0%B8%D0%B8)
* **[Настройка проекта](#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B0)**
  * [Vagrantfile](#vagrantfile)
  * [Настройка Vagrant проекта](#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-vagrant-%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B0)
  * [Настройка Web-проекта](#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-web-%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B0)
* **[Образы виртуальных машин (Виртуальные боксы)](#%D0%9E%D0%B1%D1%80%D0%B0%D0%B7%D1%8B-%D0%B2%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D1%85-%D0%BC%D0%B0%D1%88%D0%B8%D0%BD-%D0%92%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B5-%D0%B1%D0%BE%D0%BA%D1%81%D1%8B)**
  * [Получение базового образа виртуальной машины](#%D0%9F%D0%BE%D0%BB%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B1%D0%B0%D0%B7%D0%BE%D0%B2%D0%BE%D0%B3%D0%BE-%D0%BE%D0%B1%D1%80%D0%B0%D0%B7%D0%B0-%D0%B2%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B9-%D0%BC%D0%B0%D1%88%D0%B8%D0%BD%D1%8B)
  * [Удаление виртуальных боксов](#%D0%A3%D0%B4%D0%B0%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B2%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D1%85-%D0%B1%D0%BE%D0%BA%D1%81%D0%BE%D0%B2)
  * [Настройка проета для использования нужного виртуального бокса](#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D0%BF%D1%80%D0%BE%D0%B5%D1%82%D0%B0-%D0%B4%D0%BB%D1%8F-%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%BD%D1%83%D0%B6%D0%BD%D0%BE%D0%B3%D0%BE-%D0%B2%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B3%D0%BE-%D0%B1%D0%BE%D0%BA%D1%81%D0%B0)
  * [Проверка настройки](#%D0%9F%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D0%BA%D0%B0-%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B8)
* **[Настройка SSH](#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-ssh)**
* **[Обеспечение для виртуальных боксов (Provisioning)](#%D0%9E%D0%B1%D0%B5%D1%81%D0%BF%D0%B5%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%BB%D1%8F-%D0%B2%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D1%85-%D0%B1%D0%BE%D0%BA%D1%81%D0%BE%D0%B2-provisioning)**
* **[Проброс портов (Port Forwarding)](#%D0%9F%D1%80%D0%BE%D0%B1%D1%80%D0%BE%D1%81-%D0%BF%D0%BE%D1%80%D1%82%D0%BE%D0%B2-port-forwarding)**
* **[Пакетирование (Packaging)](#%D0%9F%D0%B0%D0%BA%D0%B5%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-packaging)**
* **[Остановка виртуальных боксов (Teardown)](#%D0%9E%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0-%D0%B2%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D1%85-%D0%B1%D0%BE%D0%BA%D1%81%D0%BE%D0%B2-teardown)**
* **[Быстрая пересборка](#%D0%91%D1%8B%D1%81%D1%82%D1%80%D0%B0%D1%8F-%D0%BF%D0%B5%D1%80%D0%B5%D1%81%D0%B1%D0%BE%D1%80%D0%BA%D0%B0)**


## Начало
Фактически **Vagrant** является надстройкой над программой **[VirtualBox](http://www.virtualbox.org/)** от **Oracle**, и обеспечивает быстрое создание и настройку виртуальных машин. Созданные таким образом виртуальные машины - боксы **(boxes)** используются разработчиками web-приложений для построения необходимой среды разработки. Затем они могут быть упакваны в специальные контейнеры, для установки и использования другими разработчиками в команде.

### Где взять VirtualBox
**Vagrant** полностью зависит от программы **[VirtualBox](http://www.virtualbox.org/)** и использует ее для создания виртуальных образов. Основным назначением **VirtualBox** является полная виртуализация **x86** оборудования. Это проект с открытым исходным кодом, который обеспечивает виртуализацию на профессиональном уровне и может быть использована как на серверах так и на десктопных компьютерах для построения виртуальных сред. **VirtualBox** доступен для **Windows**, **Mac OS X**, **Linux** и **Solaris**.

Вот ссылка на **[страницу загрузки VirtaulBox](http://www.virtualbox.org/wiki/Downloads)**.

На текущий момент **Vagrant** поддерживает VirtualBox 4.0.x, 4.1.x и 4.2.x.

[к началу](#%D0%9D%D0%B0%D1%87%D0%B0%D0%BB%D0%BE-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B-%D1%81-vagrant)

### Установка Vagrant
Чтобы установить **Vagrant**, необходимо скачать соответствующий пакет или установщик с **[этой страницы загрузки](http://downloads.vagrantup.com/)** и установить его, используя стандартную процедуру установки приложения на вашей системе. В операционных систмах **Windows** и **Mac OS X** после установки приложения будет доступна команда `Vagrant` из командной строки. На остальных систмах вам необходимо будет самим добавить этот путь `/opt/vagrant/bin` в переменную окружения `PATH`.

Если вы не нашли для вашей системы установщик Vagrant, то вы можете установить его используя **[RubyGems](http://rubygems.org/gems/vagrant)** с помощью команды `gem install vagrant`. Но помните, что установка из пакетов или через установщик является наиболее предпочтительным способом установки приложения.

[к началу](#%D0%9D%D0%B0%D1%87%D0%B0%D0%BB%D0%BE-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B-%D1%81-vagrant)

### Ваше первое виртуальное окружение Vagrant
В командной строке набирите:
```shell
$ vagrant box add precise32-box http://files.vagrantup.com/precise32.box
$ vagrant init precise32-box
$ vagrant up
```
Эти команды необходимы для запуска виртуальной машины с помощью **Vagrant**. Учтите, что команды выше запускают полнофункциональную виртуальную машину на операционной системе **[Ubuntu 12.04LTS precise](http://help.ubuntu.ru/wiki/precise)** с объемом памяти по-умолчанию в 512Мб.

[к началу](#%D0%9D%D0%B0%D1%87%D0%B0%D0%BB%D0%BE-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B-%D1%81-vagrant)


## Преимущества от использования Vagrant
Многие Web-разрабочики используют виртуальное окружение для разработки своих Web-приложений. Все большую популярность сейчас набирают облачные сервисы для построения и развертывания виртуальных окружений для продакшена и разработки, начиная от **[EC2](http://ru.wikipedia.org/wiki/Amazon_EC2)**, **[Rackspace Cloud](http://www.rackspace.com/cloud/)** и заканчивая более специализированными как **[EngineYard](https://www.engineyard.com/)** и **[Heroku](http://www.heroku.com/)**. **Vagrant** реализует схожие принципы при создания виртуальных машин для локальной разработки и тестирования ваших приложений на рабочем компьютере. Такая организация работы повышает гибкость и продуктивность как вас так и вашей команды при разработке web-приложений.

Для развертывания и настройки виртуальных окружений **Vagrant** использует достаточно зарекомендовавшие себя технологии виртуализации в лице **VirtualBox** от **Oracle** и технологии автоматицированного развертывания приложений от **[Chef](http://www.opscode.com/chef)** и **[Puppet](http://www.puppetlabs.com/puppet)**.

[к началу](#%D0%9D%D0%B0%D1%87%D0%B0%D0%BB%D0%BE-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B-%D1%81-vagrant)

### Преимущества для одного разработчика
Использование однотипного окружения разработки для разных проектов расчитанных для разных версий языков программирования и фреймворков зачастую очень трудная задача. Как быть, если один проект работает на PHP4, второй на PHP 5.2.x, а третий на PHP 5.3.x или 5.4.x и его необходимо тестировать в той версии языка на которую он расчитан?

Ставить кучу разных версий языков и сервисов и загружать рабочую машину, не вариант, т.к. рано или позно ваша система начнет долго загружаться, тормозить и глючить. Еще один момент, заключается в том, что каджый из рабочих проектов работает в продакшене на сервере, где стоит определенное окружение, поэтому при разработке такого проета надо, чтобы окружение на компьютере разработчика точно соответсвовало окружению на рабочем сервере, чтобы разработчик мог быть полностью уверен в том, что у него не будет неприятных сюрпризов при развертывании своего web-приложения на рабочем сервере.

**Vagrant** решает эти проблемы. С помощью него вы можете создавать виртуальные машины с окружением необходимым для каждого конкретного проекта. При переключении с одного проекта на другой, вы просто парой команд останавливаете одну виртуальную машину и поднимаете другую нужную для другого проекта. Все гениально и прсто!

[к началу](#%D0%9D%D0%B0%D1%87%D0%B0%D0%BB%D0%BE-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B-%D1%81-vagrant)

### Преимущества для команды разработчиков
Все участники команды в идеале должны иметь одинаковое окружение разработки: одинаковые версии, зависимости, настройки и т.д. ведь по идее команда работает над общими проектами. Но что если часть команды работает над проектом с одной версий базы данных, к примеру, **[MySQL](http://ru.wikipedia.org/wiki/MySQL)**, а другая часть - над проектом где используется **[PostgreSQL](http://ru.wikipedia.org/wiki/PostgreSQL)** или **[MSSQL](http://ru.wikipedia.org/wiki/Microsoft_SQL_Server)**. Что если одному участнику команды нужно приступить к разработке другого проекта, у которого другая версия языка или базы данных и т.д. Вобщем, сплошная головная боль, приводящая к замедлению разработки и уменьшению эффективности команды.

В этом случае **Vagrant** позволяет команде создавать и использовать готовые образы виртуальных окружений для соотвествующих проектов. Когда другой участник команды присоединяется к разработке другого проекта, он просто берет у своих коллег образ виртуальной машины для этого проекта и разворачивает этот образ у себя. Все, за считанные минуты разработчик получает готовое окружение и может спокойно приступать непосредственно к своей части работы.

[к началу](#%D0%9D%D0%B0%D1%87%D0%B0%D0%BB%D0%BE-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B-%D1%81-vagrant)

### Преимущества для компании
Если у вас крупная компания и вы работаете на крупным развивающимся проектом, то вам пстоянно приходится добавлять какие-то новые компоненты в инфраструктуру приложения, например, различные системы кеширования, обработчики событий, сервера баз данных и т.д. В этом случае **Vagrant** предоставляет вам средство для создания и распространения готовых окружений разработки. Теперь если к вам в компанию приходит новый сотрудник то ему нет необходимости тратиь массу времени на начальную настройку всей своей системы, чтобы присоединиться к разработке приложения.

[к началу](#%D0%9D%D0%B0%D1%87%D0%B0%D0%BB%D0%BE-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B-%D1%81-vagrant)


## Настройка проекта
После того как вы установили **Vagrant** на свою систему, все его управление осуществляется через команду `vagrant`. У этой команды есть множество необходимых подкомманд, например, `vagrant up` - для запуска виртуальной машины, `vagrant ssh` - для подключения по **[ssh](http://ru.wikipedia.org/wiki/SSH)**, `vagrant package`- для создания пакета текущего виртуального окружения готового к развертыанию на другом компьютере и т.д. Чтобы просмотреть все доступные команды, просто наберите в командной строке команду `vagrant`.

<p align="center">
  <a href="https://github.com/uran1980/web-dev-blog/edit/master/Vagrant/getting-started-with-vagrant.md">
    <img  style="max-width:100%;"
          alt="alt vagrant command"
          src="https://raw.github.com/uran1980/web-dev-blog/master/Vagrant/images/sshot-001.png" />
  </a>
</p>

### Vagrantfile
`Vagrantfile` для **Vagrant** как `Makefile` для **[Make](http://ru.wikipedia.org/wiki/Make)**. `Vagrantfile` располагается в корне каждого **Vagrant** проекта и используется для настройки поведения самого **Vagrant** и виртуальных машин созданных с помощью него. Пример содержимого этого файла приведен ниже:
```ruby
Vagrant::Config.run do |config|
  # Setup the box
  config.vm.box = "my_box"
end
```
Как вы видите, содержимое файла это код на языке **[Ruby](http://ru.wikibooks.org/wiki/Ruby)**.

### Настройка Vagrant проекта
Первым шагом для любого проекта **Vagrant** является создание корневой директории проекта и инициализация проекта:
```shell
$ mkdir my_vagrant_project
$ cd my_vagrant_project
$ vagrant init
```
команда `vagrant init` создаст файл Vagrantfile. Пока мы оставим этот файл как есть, но далее мы будем его редактировать для настройки виртуальной машины нашего проекта.

### Настройка Web-проекта
Теперь когда **Vagrant** настроен, давайте создадим небольшой web-проект, который будем потом использовать для демострации работы **Vagrant**. Создайте в корне **Vagrant** проекта (где расположен файл Vagrantfile) индексный html файл:
```shell
$ echo "<h1>Hello from a Vagrant VM</h1>" > index.html
```
В принципе на этом настройка web-проета закончена.

[к началу](#%D0%9D%D0%B0%D1%87%D0%B0%D0%BB%D0%BE-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B-%D1%81-vagrant)


## Образы виртуальных машин (Виртуальные боксы)
Следующим шагом после инициализации проета, является создание базового бокса. **Vagrant** не создает виртуальную машину с нуля. Он импортирует базовый образ виртуальной машины и запускает его, применяя затем все необходимые настройки заданные в конфигурационном файле Vagrantfile. Это упрощает жизнь пользователям **Vagrant**, т.к. им не надо тратиь время на настройку параметров виртуальной машины, таких как выделенная виртуальная память, объем диска, сетевые интерфейсы и пр.

### Получение базового образа виртуальной машины
В самом начале статьи мы уже скачали базовый образ 32-битной системы **Ubuntu 12.04LTS precise** и добавили его в **Vagrant**. Обратите внимание, что если вы уже скачали образ, то вам не нужно повторно каждый раз его скачивать при последующем запуске. **Vagrant** поддерживает загрузку образов как из Интернета, так и с вашего жесткого диска. В самом начале статьи мы запустили следующую команду:
```shell
$ vagrant box add precise32-box http://files.vagrantup.com/precise32.box
```
После ее выполнения **Vagrant** скачал образ и сохранил его в системной папке пользователя на диске. При этом этот образ был автоматических добавлен в глобальное пространство текущей установки **Vagrant** на вашем компьютере, т.е. теперь для всех проетов, которые вы будете создавать этот образ будет доступен для выбора при развертывания виртуального окружения. Также, каждый добавленный таким способом образ имеет уникальное имя, в данном примере, это **precise32-box**.

Адрес `http://files.vagrantup.com/precise32.box` мы использовали только один раз в самом начале, теперь подключать базовый образ мы будем из локального хранилища на жестком диске.

### Удаление виртуальных боксов
Таже просто как добавить, виртуальные боксы можно и удалить. Для этого используйте команду:
```shell
$ vagrant box remove my_box
```
При этом бокс удаляется физически с диска. После этого ни одна виртуальная машина созданная ранее на основе этого бокса не сможет быть запущена.

### Настройка проета для использования нужного виртуального бокса
Теперь, когда виртуальный бокс с именем `precise32-box` был добавлен в **Vagrant** мы можем добавлять его в наши проеты. Это делается путем записи в конфигурационный файл Vagrantfile следующей строчки:
```ruby
Vagrant::Config.run do |config|
  config.vm.box = "precise32-box"
end
```

### Проверка настройки
На данный момент мы произвели самую базовую настройку нашего виртуального окружения. Мы не задали переброс портов **(port forwarding)**, свое обспечение для окружения **(provisioning)** и т.д. Но даже с такой базовой настройкой у нас получилась полнофункциональная виртуальная машина. Вы можете в этом убедится набрав следующую команду `vagrant up` из корневой директории проекта Эта команда запустит виртуальную машину. Чтобы остановить запущенную виртуальную машину и очистить место на диске, которое она занимала, нужно выполнить команду `vagrant destroy`:
```shell
$ vagrant up
...
$ vagrant destroy
...
```

[к началу](#%D0%9D%D0%B0%D1%87%D0%B0%D0%BB%D0%BE-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B-%D1%81-vagrant)


## Настройка SSH
TODO

[к началу](#%D0%9D%D0%B0%D1%87%D0%B0%D0%BB%D0%BE-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B-%D1%81-vagrant)


## Обеспечение для виртуальных боксов (Provisioning)
TODO

[к началу](#%D0%9D%D0%B0%D1%87%D0%B0%D0%BB%D0%BE-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B-%D1%81-vagrant)


## Проброс портов (Port Forwarding)
TODO

[к началу](#%D0%9D%D0%B0%D1%87%D0%B0%D0%BB%D0%BE-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B-%D1%81-vagrant)


## Пакетирование (Packaging)
TODO

[к началу](#%D0%9D%D0%B0%D1%87%D0%B0%D0%BB%D0%BE-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B-%D1%81-vagrant)


## Остановка виртуальных боксов (Teardown)
TODO

[к началу](#%D0%9D%D0%B0%D1%87%D0%B0%D0%BB%D0%BE-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B-%D1%81-vagrant)


## Быстрая пересборка
TODO

[к началу](#%D0%9D%D0%B0%D1%87%D0%B0%D0%BB%D0%BE-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B-%D1%81-vagrant)


## Полезные ссылки
* **[Available Vagrant Boxes](https://github.com/mitchellh/vagrant/wiki/Available-Vagrant-Boxes)** - доступные образы **Vagrant**
* **[www.vagrantbox.es](http://www.vagrantbox.es/)** - еще образы **Vagrant**


## См. также
* **[Оригинал этой статьи](http://docs.vagrantup.com/v1/docs/getting-started/rebuild.html)** (англ.)
